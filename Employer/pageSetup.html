<div data-page-setup>
</div>
<script>
var neatlistB = {};

Object.defineProperty(neatlistB, 'key', {
  value: 'RXu4QwYFcshkvXqFko7osvCIX09zc7g9',
  enumerable: false,
});
class PageSetup {
  constructor() {
    $("[data-page-setup]").empty();
     this.pageIsSetup = false
     this.inputSession = $("<input type='hidden' data-sessioned value='true'>");
     this.inputEmail = $("<input type='hidden' data-email>");
     this.inputAccountType = $("<input type='hidden' data-account-type>");
     this.inputFullName = $("<input type='hidden' data-fullname>");
     this.inputCurrentPage = $("<input type='hidden' data-current-page>");
     this.email = null
     $("#professional-profile-email").attr("readonly",true)
     $("#professional-profile-fullname").attr("readonly",true)
     $("#professional-profile-phone").attr("readonly",true)
     this.verified=null;
  	}
    async _loadMemberStack() {
      if(this.pageIsSetup) {
       return
      }
    window.$memberstackDom.getCurrentMember().then((member) => {
    console.log(member.data, "member.data")
    if (member.data) {
      $("[data-page-setup]").append(this.inputSession)

      const fullNameValue = member.data.customFields["first-name"] + " " + member.data.customFields["last-name"]
      this.inputFullName.val(fullNameValue);
      $("[data-page-setup]").append(this.inputFullName)
       this.inputEmail.val(member.data.auth.email)
       this.email = member.data.auth.email
      $("[data-page-setup]").append(this.inputEmail)
      this.inputAccountType.val(member.data.customFields["account-type"]);
      $("[data-page-setup]").append(this.inputAccountType)
      $("#create-profile-full-name").val(fullNameValue)
        if(this.inputAccountType.val()=="company") {
          $("#nav-link-dashboard-pro").hide()
          $("#nav-link-dashboard").show()
        } else if(this.inputAccountType.val()=="individual") {
          $("#nav-link-dashboard-pro").hide()
          $("#nav-link-dashboard").show()
        } else if(this.inputAccountType.val()=="professional") {
          $("#nav-link-dashboard-pro").show()
          $("#nav-link-dashboard").hide()
          //window.location.href="/dashboards/dashboard-prof"
        } else {
          console.log("no account-type")
        }
          if(!localStorage.getItem("sessioned")) {
            //if(!document.querySelector('[data-sessioned]')) {
          localStorage.setItem("sessioned", true)
          this.inputEmail.val(member.data.auth.email);
          $("[data-page-setup]").append(this.inputEmail);
          //window.location.href="/home"
          if(this.inputAccountType.val()=="company") {
             //	$("#nav-link-dashboard").attr("href", "/dashboards/dashboard")
               window.location.href="/dashboards/dashboard"
          } else if(this.inputAccountType.val()=="individual") {
              //$("#nav-link-dashboard").attr("href", "/dashboards/dashboard")
              window.location.href="/dashboards/dashboard"
          } else if(this.inputAccountType.val()=="professional") {
            //  $("#nav-link-dashboard").attr("href", "/dashboards/dashboard-prof")
              window.location.href="/dashboards/dashboard-prof"
          } else {
           
          }
      }
      $("#side-signup-1").hide()
      this.verified = member.data.verified
      $("#btn-signup-drawer-knob").text("Verify")
      if(!this.verified) {
        $("#wf-form--2").hide()
        $("#verification").show()
        $(this).css("display", "none")
      }
      if(this.inputAccountType.val()) {
         if(this.verified || this.inputCurrentPage.val() == "dashboard") {
           $("#btn-drawer-signup-side").hide()
         } else if(this.verified || this.inputAccountType.val() == "professional") {
            if(this.inputFullName.val() && $("#professional-profile-fullname")) {
              $("#professional-profile-fullname").val(this.inputFullName.val())
            }
          }
        }
    	  this._getUserId()
    } else {
      $("#btn-drawer-signup-side").show()
      localStorage.clear()
    }
   })
  }
  async _getUserId() {
      //sessionStorage.getItem("user_account_id"), "UAID"
        if(this.pageIsSetup) {
          return
        }
        console.log(" _getUserId()")
        const inputUAID = $("<input type='hidden' data-user_account_id>");
        const user_account_idInput = document.querySelector('[data-user_account_id]')
        
        const accountType = document.querySelector('[data-account-type]')
        if(user_account_idInput) {
          if(user_account_idInput.value) {
            console.log("user_account_id is good ",user_account_idInput.value )
          }
        } else {
        	const emailInput = document.querySelector('[data-email]')
          console.log("user_account_id input not created. creating now...")
          if(this.email) {
              // const tableReference = accountType.value=="professional" ? "119373" : accountType.value==="company" || accountType.value==="individual" ? "116205" : null
              // const fieldReference = accountType.value=="professional" ? "field_760997" : accountType.value==="company" || accountType.value==="individual" ? "field_738184" : null
              const tableReference =  "116205"
              const fieldReference =  "field_738184"
              if(tableReference !== null) {
                  console.log("fetching...")
                  fetchData("https://api.baserow.io/api/database/rows/table/"+tableReference+"/?filter__"+fieldReference+"__equal="+this.email).then(value=>{     
                    //sessionStorage.setItem("user_account_id", value.data.results[0].id)
                    console.log(value.data.results[0], "test shits")
                    if(value.data.count > 0) {
                      const employer  = new Employer(value.data.results[0]);
                      objectRegistrar.set("employer", employer)
                      this.pageIsSetup = true
                    }
                    
                })
              }
            }
        }
		}
}//pageSetup class

</script>